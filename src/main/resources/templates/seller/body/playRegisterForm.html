<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>공연 정보 등록</title>
<link rel="stylesheet" th:href="@{/static/css/common.css}">
<link rel="stylesheet" th:href="@{/static/css/playRegisterForm.css}">
</head>
<body>
<div class="container">
		<div class="title">공연 정보 등록</div>
        <form class="row g-3 needs-validation" id="playRegisterForm" novalidate>
            <!-- 공연명 -->
            <div class="mb-3">
                <label for="play_name" class="form-label">공연명</label>
                <input type="text" class="form-control" id="play_name" name= "play_name" placeholder="공연명을 입력하세요" required>
                <div class="invalid-feedback">공연명을 입력해 주세요.</div>
            </div>
            
            <!-- 공연 시작 및 종료 날짜 -->
            <div class="mb-3 row" style="padding : 0">
                <div class="col">
                    <label for="start_date" class="form-label">공연 기간 시작일</label>
                    <input type="date" class="form-control" id="start_date" style="width: 250px;" required>
                    <div class="invalid-feedback">공연 시작 날짜를 입력해 주세요.</div>
                </div>
                <div class="col">
                    <label for="end_date" class="form-label">공연 기간 종료일</label>
                    <input type="date" class="form-control" id="end_date" style="width: 250px;" required>
                    <div class="invalid-feedback">공연 종료 날짜를 입력해 주세요.</div>
                    <div id="end_date_invalid-feedback"> </div>
                </div>
            </div>

            <!-- 공연 위치 등록 - 우편 API-->
            <!-- 
            <div class="mb-3 row">
                <div class="col-auto">
                    <label for="zipcode" class="form-label">공연장 등록</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="postcode" name="postcode" placeholder="우편번호" style="width: 100px;" required>
                        <div class="invalid-feedback">우편번호를 입력해 주세요.</div>
                    	<input type="button"  class="btn btn-outline-secondary" onclick="daumPostCodeSearch()" value="우편번호 찾기"><br>
                    </div>
                </div>
                <div class="col">
                    <label for="address" class="form-label">상세주소</label>
                    <input type="text" name="address" class="form-control" id="address" placeholder="상세주소 입력" required>
                    <div class="invalid-feedback">상세 주소를 입력해 주세요.</div>
                </div>
            </div>
            -->
            
		    <!-- 상영관 타입 등록 -->
            <div class="mb-3">
                <label for="venueSelect" class="form-label">상영관 타입 선택</label>
                <select class="form-select" id="venueSelect" required>
                    <option selected disabled value="">상영관을 선택하세요</option>
                    <option value="venue1">A타입</option>
                    <option value="venue2">B타입</option>
                    <option value="venue3">C타입</option>
                </select>
                <div class="invalid-feedback">상영관 타입을 선택해 주세요.</div>
            </div>

            <!-- 총 출연진 등록 -->
            <div class="mb-3">
                <label for="total_actor" class="form-label">총 출연진</label>
                <input type="text" class="form-control" id="total_actor" name="total_actor" placeholder="출연진을 입력하세요." required>
                <div class="invalid-feedback">출연진을 입력해 주세요.</div>
            </div>

            <!-- 공연포스터 이미지 업로드 -->
            <div class="mb-3">
                <label for="posterUpload" class="form-label">공연포스터 등록</label>
                <input type="file" class="form-control" id="posterUpload" accept="image/*" onchange="previewImage()" required>
                <div class="invalid-feedback">공연 포스터를 업로드해 주세요.</div>
            </div>
            
            <!-- 공연포스터 이미지 미리보기 -->
            <div class="mb-3 text-center">
                <img id="posterPreview" class="rounded-custom" src="" alt="이미지 미리보기" style="display: none; max-width: 100%; height: auto; margin-top: 10px;">
                <div id="posterPreviewMsg"></div>
            </div>

            <!-- 네이버 스마트에디터 2.0 API -->
            <div id="smarteditor">
                <textarea name="description" id="editorTxt" rows="40" cols="10" style="width: 100%; height: 500px;" placeholder="내용을 입력해주세요." required></textarea>
            </div>

           <div class="form-footer">
				<button type="submit" class="btn btn-primary">등록</button>
				<button type="reset" class="btn btn-secondary"
					onclick="noticeClearPreview()">초기화</button>
			</div>
        </form>
    </div>
</body>
<script type="text/javascript">
document.getElementById('playRegisterForm').addEventListener('submit', function(event) {
	event.preventDefault(); // 기본 제출 방지

    var form = this;

    // 브라우저 기본 유효성 검사
    /*
    if (!form.checkValidity()) {
        form.classList.add('was-validated'); // 부트스트랩 유효성 스타일 추가
        return; // 유효성 실패 시 중단
    }
	*/
	
    // 유효성 통과 후 AJAX 요청
    var formData = {
        play_name: document.getElementById('play_name').value,
        start_date: document.getElementById('start_date').value,
        end_date: document.getElementById('end_date').value,
        description: document.getElementById('description').value,
        total_actor: document.getElementById('total_actor').value
    };

    $.ajax({
        type: 'post',
        url: '/api/playTimeTables/playRegisterWrite',
        data: JSON.stringify(formData),
        contentType: 'application/json; charset=utf-8',
        success: function() {
            location.href = '/secure/seller/index';
        },
        error: function(error) {
            console.log('에러 발생:', error);
        }
    });
});

function previewImage() {
    const fileInput = document.getElementById('posterUpload');
    const preview = document.getElementById('posterPreview');
    
    const file = fileInput.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
        document.getElementById("posterPreviewMsg").innerHTML = "<p style='color: grey;'> 포스터 미리보기 </p>";
    } else {
        preview.src = '';
        preview.style.display = 'none';
    }
}


function smartEditor() {
	// 네이버 스마트 에디터 2.0 API 
	let oEditors = [];
	
    console.log("Naver SmartEditor");
    nhn.husky.EZCreator.createInIFrame({
        oAppRef: oEditors,
        elPlaceHolder: "editorTxt",
        sSkinURI: "/static/smarteditor/SmartEditor2Skin.html",
        fCreator: "createSEditor2"
    });
}

$(document).ready(function() {
    smartEditor();
});
</script>
</body>
<script th:src="@{/static/js/playRegisterForm.js}"></script>
<script th:src="@{/static/js/writeForm.js}"></script>
</html>
